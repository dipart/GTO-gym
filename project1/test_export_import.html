<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>GTO å¯¼å‡º/å¯¼å…¥åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª GTO å¯¼å‡º/å¯¼å…¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•ç¯å¢ƒå‡†å¤‡</h2>
        <button class="btn-primary" onclick="setupTestData()">åˆ›å»ºæµ‹è¯•æ•°æ®</button>
        <button class="btn-warning" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
        <button class="btn-success" onclick="showCurrentData()">æ˜¾ç¤ºå½“å‰æ•°æ®</button>
        <div id="setupResult"></div>
    </div>
    
    <div class="test-section">
        <h2>å¯¼å‡ºåŠŸèƒ½æµ‹è¯•</h2>
        <button class="btn-primary" onclick="testExport()">æµ‹è¯•å¯¼å‡ºåŠŸèƒ½</button>
        <div id="exportResult"></div>
    </div>
    
    <div class="test-section">
        <h2>å¯¼å…¥åŠŸèƒ½æµ‹è¯•</h2>
        <input type="file" id="testFileInput" accept=".json" style="display:none" onchange="testImport(event)">
        <button class="btn-primary" onclick="document.getElementById('testFileInput').click()">æµ‹è¯•å¯¼å…¥åŠŸèƒ½</button>
        <div id="importResult"></div>
    </div>
    
    <div class="test-section">
        <h2>å®Œæ•´æµç¨‹æµ‹è¯•</h2>
        <button class="btn-success" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <div id="fullTestResult"></div>
    </div>

<script>
    // æµ‹è¯•æ•°æ®ç”Ÿæˆ
    function setupTestData() {
        clearAllData();
        
        const testData = [
            { key: "GTO|MTT|8-Max|UTG|20BB|RFI", data: {"AA":"raise","KK":"raise","AKs":"raise"} },
            { key: "GTO|Cash|6-Max|BTN|100BB|RFI", data: {"AA":"raise","KK":"raise","QQ":"raise","AKo":"raise"} },
            { key: "GTO|MTT|9-Max|SB|15BB|vs_3bet", data: {"AA":"raise","KK":"raise","AKs":"mix"} }
        ];
        
        testData.forEach(item => {
            localStorage.setItem(item.key, JSON.stringify(item.data));
        });
        
        showResult('setupResult', 'success', `âœ… åˆ›å»ºäº† ${testData.length} æ¡æµ‹è¯•æ•°æ®`);
    }
    
    function clearAllData() {
        const keys = [];
        for(let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if(key.startsWith('GTO|')) {
                keys.push(key);
            }
        }
        keys.forEach(key => localStorage.removeItem(key));
        showResult('setupResult', 'info', `ğŸ—‘ï¸ æ¸…ç©ºäº† ${keys.length} æ¡æ•°æ®`);
    }
    
    function showCurrentData() {
        const data = {};
        let count = 0;
        
        for(let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if(key.startsWith('GTO|')) {
                try {
                    data[key] = JSON.parse(localStorage.getItem(key));
                    count++;
                } catch(e) {
                    data[key] = 'æŸåçš„æ•°æ®';
                }
            }
        }
        
        const result = document.getElementById('setupResult');
        result.innerHTML = `<div class="test-result info"><strong>å½“å‰æ•°æ® (${count}æ¡):</strong><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
    }
    
    // å¯¼å‡ºåŠŸèƒ½æµ‹è¯•
    function testExport() {
        const exportData = {};
        const metadata = {
            exportDate: new Date().toISOString(),
            version: "1.0",
            totalRecords: 0
        };
        
        for(let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if(key.startsWith('GTO|')) {
                try {
                    const value = localStorage.getItem(key);
                    exportData[key] = JSON.parse(value);
                    metadata.totalRecords++;
                } catch(e) {
                    console.warn(`è·³è¿‡æŸåçš„æ•°æ®: ${key}`);
                }
            }
        }
        
        if(metadata.totalRecords === 0) {
            showResult('exportResult', 'error', 'âš ï¸ æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
            return;
        }
        
        const fullExport = { metadata, data: exportData };
        const jsonString = JSON.stringify(fullExport, null, 2);
        
        showResult('exportResult', 'success', 
            `âœ… å¯¼å‡ºæµ‹è¯•æˆåŠŸï¼<br>
            ğŸ“Š è®°å½•æ•°: ${metadata.totalRecords}<br>
            ğŸ“… å¯¼å‡ºæ—¶é—´: ${metadata.exportDate}<br>
            ğŸ“„ æ–‡ä»¶å¤§å°: ${(jsonString.length / 1024).toFixed(2)} KB<br>
            <details><summary>æŸ¥çœ‹å¯¼å‡ºæ•°æ®</summary><pre>${jsonString}</pre></details>`
        );
    }
    
    // å¯¼å…¥åŠŸèƒ½æµ‹è¯•
    function testImport(event) {
        const file = event.files[0];
        if(!file) return;
        
        if(!file.name.endsWith('.json')) {
            showResult('importResult', 'error', 'âŒ è¯·é€‰æ‹©JSONæ–‡ä»¶');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importData = JSON.parse(e.target.result);
                
                if(!importData.data || typeof importData.data !== 'object') {
                    throw new Error("æ— æ•ˆçš„æ•°æ®æ ¼å¼");
                }
                
                let importedCount = 0;
                let skippedCount = 0;
                
                Object.keys(importData.data).forEach(key => {
                    if(key.startsWith('GTO|')) {
                        try {
                            const value = JSON.stringify(importData.data[key]);
                            localStorage.setItem(key, value);
                            importedCount++;
                        } catch(e) {
                            skippedCount++;
                        }
                    }
                });
                
                showResult('importResult', 'success', 
                    `âœ… å¯¼å…¥æµ‹è¯•æˆåŠŸï¼<br>
                    ğŸ“¥ æˆåŠŸå¯¼å…¥: ${importedCount}æ¡<br>
                    âš ï¸ è·³è¿‡: ${skippedCount}æ¡<br>
                    ğŸ“Š å…ƒæ•°æ®: ${JSON.stringify(importData.metadata, null, 2)}`
                );
                
                event.target.value = '';
                
            } catch(error) {
                showResult('importResult', 'error', 'âŒ æ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–æ•°æ®æŸå');
                event.target.value = '';
            }
        };
        
        reader.onerror = function() {
            showResult('importResult', 'error', 'âŒ æ–‡ä»¶è¯»å–å¤±è´¥');
            event.target.value = '';
        };
        
        reader.readAsText(file);
    }
    
    // å®Œæ•´æµç¨‹æµ‹è¯•
    function runFullTest() {
        const result = document.getElementById('fullTestResult');
        result.innerHTML = '<div class="test-result info">ğŸ”„ å¼€å§‹å®Œæ•´æµ‹è¯•...</div>';
        
        try {
            // æ­¥éª¤1: æ¸…ç†ç¯å¢ƒ
            clearAllData();
            result.innerHTML += '<div class="test-result success">âœ… ç¯å¢ƒæ¸…ç†å®Œæˆ</div>';
            
            // æ­¥éª¤2: åˆ›å»ºæµ‹è¯•æ•°æ®
            setupTestData();
            result.innerHTML += '<div class="test-result success">âœ… æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆ</div>';
            
            // æ­¥éª¤3: æµ‹è¯•å¯¼å‡º
            const exportData = {};
            const metadata = { exportDate: new Date().toISOString(), version: "1.0", totalRecords: 0 };
            
            for(let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if(key.startsWith('GTO|')) {
                    exportData[key] = JSON.parse(localStorage.getItem(key));
                    metadata.totalRecords++;
                }
            }
            
            const fullExport = { metadata, data: exportData };
            result.innerHTML += '<div class="test-result success">âœ… å¯¼å‡ºåŠŸèƒ½æ­£å¸¸</div>';
            
            // æ­¥éª¤4: æ¸…ç†å¹¶å¯¼å…¥
            clearAllData();
            result.innerHTML += '<div class="test-result success">âœ… æ•°æ®æ¸…ç†å®Œæˆ</div>';
            
            Object.keys(fullExport.data).forEach(key => {
                localStorage.setItem(key, JSON.stringify(fullExport.data[key]));
            });
            
            result.innerHTML += '<div class="test-result success">âœ… å¯¼å…¥åŠŸèƒ½æ­£å¸¸</div>';
            
            // æ­¥éª¤5: éªŒè¯æ•°æ®å®Œæ•´æ€§
            let verifiedCount = 0;
            Object.keys(fullExport.data).forEach(key => {
                const original = fullExport.data[key];
                const imported = JSON.parse(localStorage.getItem(key));
                if(JSON.stringify(original) === JSON.stringify(imported)) {
                    verifiedCount++;
                }
            });
            
            result.innerHTML += `<div class="test-result success">âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯: ${verifiedCount}/${metadata.totalRecords} æ¡è®°å½•å®Œå…¨åŒ¹é…</div>`;
            result.innerHTML += '<div class="test-result success"><strong>ğŸ‰ å®Œæ•´æµ‹è¯•é€šè¿‡ï¼å¯¼å‡º/å¯¼å…¥åŠŸèƒ½å·¥ä½œæ­£å¸¸</strong></div>';
            
        } catch(error) {
            result.innerHTML += `<div class="test-result error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
        }
    }
    
    function showResult(elementId, type, message) {
        const element = document.getElementById(elementId);
        element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
    }
</script>
</body>
</html>